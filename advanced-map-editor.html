<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GORET - Advanced Map Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            overflow: hidden;
        }

        .editor-container {
            display: flex;
            height: 100vh;
        }

        .canvas-area {
            flex: 1;
            position: relative;
            background: #0f1419;
        }

        #mapCanvas {
            display: block;
            cursor: crosshair;
            background: #1e3a5f;
        }

        .control-panel {
            width: 400px;
            background: rgba(30, 60, 95, 0.95);
            backdrop-filter: blur(10px);
            border-left: 2px solid #3498db;
            padding: 20px;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(52, 73, 94, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .panel-title {
            font-size: 16px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .panel-title::before {
            content: "üó∫Ô∏è";
            margin-right: 8px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #2980b9, #3498db);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, #7f8c8d, #95a5a6);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(149, 165, 166, 0.4);
        }

        .input-group {
            margin: 10px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #bdc3c7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 4px;
            background: rgba(44, 62, 80, 0.8);
            color: #ecf0f1;
            font-size: 14px;
        }

        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 400px;
            background: rgba(30, 60, 95, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-bottom: 2px solid #3498db;
            z-index: 1000;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
            margin: 0;
        }

        .header .subtitle {
            font-size: 12px;
            color: #bdc3c7;
            margin-top: 5px;
        }

        .canvas-wrapper {
            margin-top: 80px;
            height: calc(100vh - 80px);
            overflow: auto;
        }

        .tool-bar {
            position: absolute;
            top: 90px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .tool-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 8px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-btn:hover {
            background: rgba(52, 152, 219, 1);
            transform: scale(1.1);
        }

        .tool-btn.active {
            background: #e74c3c;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }

        .coordinates-display {
            position: absolute;
            top: 90px;
            right: 420px;
            background: rgba(44, 62, 80, 0.9);
            padding: 10px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 400px;
            background: rgba(44, 62, 80, 0.9);
            padding: 10px 20px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(52, 152, 219, 0.3);
        }

        .debug-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 400px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #e74c3c;
            border-radius: 8px;
            color: white;
            font-family: 'Courier New', monospace;
            z-index: 20000;
            display: none;
            flex-direction: column;
        }

        .debug-header {
            background: #e74c3c;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
        }

        .section-header {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid #3498db;
            border-radius: 4px;
            padding: 8px 12px;
            margin: 15px 0 10px 0;
            font-size: 14px;
            font-weight: bold;
            color: #3498db;
            text-align: center;
        }

        .input-row {
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }

        kbd {
            background: rgba(44, 62, 80, 0.8);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 3px;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #3498db;
            margin: 0 2px;
        }

        .performance-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fps-meter {
            background: rgba(46, 204, 113, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .memory-meter {
            background: rgba(52, 152, 219, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="canvas-area">
            <div class="header">
                <h1>üó∫Ô∏è GORET Advanced Map Editor</h1>
                <div class="subtitle">Professional Map Creation & Game Integration Platform v2.0.0</div>
            </div>
            
            <div class="tool-bar">
                <button class="tool-btn active" data-tool="select" title="Select Tool (V)">üëÜ</button>
                <button class="tool-btn" data-tool="move" title="Move Tool (M)">‚úã</button>
                <button class="tool-btn" data-tool="rotate" title="Rotate Tool (R)">üîÑ</button>
                <button class="tool-btn" data-tool="collision" title="Collision Editor (C)">üí•</button>
                <button class="tool-btn" data-tool="measure" title="Measure Tool (L)">üìè</button>
            </div>
            
            <div class="coordinates-display" id="coordinatesDisplay">
                Mouse: (0, 0) | World: (0, 0) | Tool: Select
            </div>
            
            <div class="canvas-wrapper">
                <canvas id="mapCanvas" width="1600" height="1000" oncontextmenu="return false;"></canvas>
            </div>
            
            <div class="status-bar">
                <div class="performance-indicator">
                    <div class="fps-meter" id="fpsDisplay">60 FPS</div>
                    <div class="memory-meter" id="memoryDisplay">0 MB</div>
                </div>
                <div id="statusMessage">Advanced Map Editor Ready</div>
                <div id="selectionInfo">No selection</div>
            </div>
        </div>
        
        <div class="control-panel">
            <!-- Edit Actions -->
            <div class="panel-section">
                <div class="panel-title">‚úèÔ∏è Edit Actions</div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button class="btn btn-primary" data-action="undo" onclick="advancedEditor.undo()" style="flex: 1;" title="Ctrl+Z">
                        ‚Ü∂ Undo
                    </button>
                    <button class="btn btn-primary" data-action="redo" onclick="advancedEditor.redo()" style="flex: 1;" title="Ctrl+Y">
                        ‚Ü∑ Redo
                    </button>
                </div>
                
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-success" onclick="advancedEditor.save()" style="flex: 1;" title="Ctrl+S">
                        üíæ Save
                    </button>
                    <button class="btn btn-secondary" onclick="advancedEditor.showHistoryPanel()" style="flex: 1;">
                        üìú History
                    </button>
                </div>
                
                <button class="btn btn-warning" onclick="advancedEditor.testUndoSystem()" style="width: 100%;">
                    üß™ Test Undo System
                </button>
            </div>
            
            <!-- Island Management -->
            <div class="panel-section">
                <div class="panel-title">üèùÔ∏è Island Management</div>
                
                <input type="file" id="imageInput" style="display: none;" accept="image/*">
                <button class="btn btn-primary" onclick="document.getElementById('imageInput').click()">
                    üìÅ Load Island Image
                </button>
                
                <div class="section-header">Island Properties</div>
                
                <div class="input-group">
                    <label>Island Selection</label>
                    <select id="islandSelector" onchange="advancedEditor.selectIslandFromDropdown()">
                        <option value="">-- Select Island --</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Island Name</label>
                    <select id="islandName">
                        <option value="__new__" selected>+ Add New Island</option>
                    </select>
                </div>
                
                <div class="input-row">
                    <div class="input-group" style="flex: 1;">
                        <label>X Position</label>
                        <input type="number" id="islandX" value="0">
                    </div>
                    <div class="input-group" style="flex: 1;">
                        <label>Y Position</label>
                        <input type="number" id="islandY" value="0">
                    </div>
                </div>
                
                <div class="input-row">
                    <div class="input-group" style="flex: 1;">
                        <label>Width</label>
                        <input type="number" id="islandWidth" value="400" min="50" max="2000">
                    </div>
                    <div class="input-group" style="flex: 1;">
                        <label>Height</label>
                        <input type="number" id="islandHeight" value="300" min="50" max="2000">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Rotation (degrees)</label>
                    <input type="range" id="islandRotation" min="0" max="360" value="0">
                    <input type="number" id="islandRotationValue" min="0" max="360" value="0" style="width: 60px; margin-top: 5px;">
                </div>
                
                <div class="input-group">
                    <label>Collision Radius</label>
                    <input type="range" id="islandRadius" min="50" max="500" value="150">
                    <input type="number" id="islandRadiusValue" min="50" max="500" value="150" style="width: 70px; margin-top: 5px;">
                </div>
                
                <button class="btn btn-success" onclick="advancedEditor.addIsland()">
                    ‚ûï Add Island
                </button>
                
                <div class="section-header">Auto-Fitting</div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button class="btn btn-warning" onclick="if(advancedEditor.selectedIsland) advancedEditor.fitImageToCollisionBounds(advancedEditor.selectedIsland)" style="flex: 1;" title="Fit selected island to collision bounds">
                        üìê Fit to Bounds
                    </button>
                    <button class="btn btn-warning" onclick="advancedEditor.autoFitAllIslands()" style="flex: 1;" title="Auto-fit all islands to their collision bounds">
                        üìê Fit All
                    </button>
                </div>
            </div>
            
            <!-- Collision Editor -->
            <div class="panel-section">
                <div class="panel-title">üí• Collision Editor</div>
                
                <div class="section-header">Collision Tools</div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="collisionEditor.setTool('add')" style="flex: 1;">
                        üìç Add Point
                    </button>
                    <button class="btn btn-primary" onclick="advancedEditor.toggleCollisionLineMode()" id="collisionLineModeBtn" style="flex: 1;">
                        ‚úèÔ∏è Draw Line
                    </button>
                </div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button class="btn btn-danger" onclick="collisionEditor.setTool('remove')" style="flex: 1;">
                        ‚ûñ Remove
                    </button>
                    <button class="btn btn-warning" onclick="advancedEditor.optimizePoints()" style="flex: 1;">
                        ‚ö° Basic Optimize
                    </button>
                </div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button class="btn btn-warning" onclick="collisionEditor.setTool('smooth')" style="flex: 1;">
                        „Ä∞Ô∏è Smooth
                    </button>
                    <button class="btn btn-secondary" onclick="collisionEditor.setTool('optimize')" style="flex: 1;">
                        ‚ö° Optimize
                    </button>
                </div>
                
                <button class="btn btn-primary" onclick="collisionEditor.setTool('trace')" style="width: 100%;">
                    üñäÔ∏è Auto Trace from Image
                </button>
                
                <div class="section-header">Collision Layers</div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button class="btn btn-secondary" onclick="collisionEditor.setActiveLayer('land')" style="flex: 1;">
                        üèîÔ∏è Land
                    </button>
                    <button class="btn btn-secondary" onclick="collisionEditor.setActiveLayer('water')" style="flex: 1;">
                        üåä Water
                    </button>
                </div>
                
                <div id="collisionStats" style="font-size: 12px; color: #bdc3c7; margin-top: 10px;">
                    Select an island to edit collision
                </div>
                
                <div class="section-header">Collision Points</div>
                <div class="collision-points-list" id="collisionPointsList" style="max-height: 200px; overflow-y: auto; background: rgba(44, 62, 80, 0.5); border-radius: 4px; padding: 5px;">
                    <div style="text-align: center; color: #7f8c8d; font-style: italic;">
                        Select an island to edit collision points
                    </div>
                </div>
            </div>
            
            <!-- World Display -->
            <div class="panel-section">
                <div class="panel-title">üåç World Display</div>
                
                <button class="btn btn-primary" onclick="advancedEditor.resetToWorldView()">
                    üåç Show Full World
                </button>
                
                <button class="btn btn-primary" onclick="advancedEditor.toggleGrid()" id="gridBtn">
                    üìé Hide Grid
                </button>
                
                <button class="btn btn-primary" onclick="advancedEditor.toggleBounds()" id="boundsBtn">
                    üî≤ Hide Boundaries
                </button>
                
                <button class="btn btn-primary" onclick="advancedEditor.toggleOceanWaves()" id="wavesBtn">
                    üåä Show Waves
                </button>
                
                <button class="btn btn-primary" onclick="advancedEditor.toggleCollisionBounds()" id="collisionBtn">
                    üî¥ Hide Collision
                </button>
            </div>
            
            <!-- Export & Import -->
            <div class="panel-section">
                <div class="panel-title">üíæ Export & Import</div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button class="btn btn-success" onclick="advancedEditor.exportAdvanced()" style="flex: 1;">
                        üì§ Export
                    </button>
                    <button class="btn btn-warning" onclick="advancedEditor.importAdvanced()" style="flex: 1;">
                        üì• Import
                    </button>
                </div>
                
                <button class="btn btn-info" onclick="advancedEditor.generateGameCode()" style="width: 100%;">
                    üéÆ Generate Game Code
                </button>
                
                <button class="btn btn-warning" onclick="advancedEditor.generateIslandsDataFile()" style="width: 100%;">
                    üìÑ Generate islands-data.js
                </button>
                
                <button class="btn btn-success" onclick="advancedEditor.saveProject()" style="width: 100%;">
                    üíæ Save Project
                </button>
            </div>
            
            <!-- Controls Guide -->
            <div class="panel-section">
                <div class="panel-title">üéÆ Advanced Controls</div>
                
                <div style="font-size: 12px; line-height: 1.6; color: #bdc3c7;">
                    <div><strong style="color: #3498db;">Tools:</strong></div>
                    <div>‚Ä¢ <kbd>V</kbd> - Select Tool</div>
                    <div>‚Ä¢ <kbd>M</kbd> - Move Tool</div>
                    <div>‚Ä¢ <kbd>R</kbd> - Rotate Tool</div>
                    <div>‚Ä¢ <kbd>C</kbd> - Collision Editor</div>
                    <div>‚Ä¢ <kbd>L</kbd> - Measure Tool</div>
                    
                    <div style="margin-top: 10px;"><strong style="color: #e74c3c;">Edit Actions:</strong></div>
                    <div>‚Ä¢ <kbd>Ctrl+Z</kbd> - Undo last action</div>
                    <div>‚Ä¢ <kbd>Ctrl+Y</kbd> - Redo last action</div>
                    <div>‚Ä¢ <kbd>Ctrl+S</kbd> - Save map</div>
                    <div>‚Ä¢ <kbd>Ctrl+C</kbd> - Copy selected</div>
                    <div>‚Ä¢ <kbd>Ctrl+V</kbd> - Paste copied</div>
                    
                    <div style="margin-top: 10px;"><strong style="color: #f39c12;">Navigation:</strong></div>
                    <div>‚Ä¢ <kbd>W A S D</kbd> - Pan view</div>
                    <div>‚Ä¢ <kbd>Mouse Wheel</kbd> - Zoom</div>
                    <div>‚Ä¢ <kbd>0</kbd> - Reset zoom</div>
                    <div>‚Ä¢ <kbd>Space</kbd> - Pan mode</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <div class="debug-header">
            <h3>üêõ Advanced Debug Console</h3>
            <button onclick="document.getElementById('debugPanel').style.display='none'" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">‚úï</button>
        </div>
        <div class="debug-content" id="debugContent">
            <div>Advanced Map Editor Debug Console</div>
            <div>Version: 2.0.0-advanced</div>
            <div>Status: Ready</div>
        </div>
    </div>

    <!-- Load existing game files first -->
    <script src="js/islands-data.js"></script>
    <script src="js/collision.js"></script>
    
    <!-- Load the advanced map editor -->
    <script src="js/map-editor/AdvancedMapEditor.js"></script>
    <script src="js/map-editor/EnhancedCollisionEditor.js"></script>
    <script src="js/map-editor/TestingFramework.js"></script>
    <script src="js/map-editor/ResizeRotateHandlers.js"></script>
    
    <script>
        // Initialize the advanced map editor
        let advancedEditor;
        let collisionEditor;
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize advanced editor
                advancedEditor = new AdvancedMapEditor();
                await advancedEditor.init();
                
                // Initialize collision editor
                collisionEditor = new EnhancedCollisionEditor(advancedEditor);
                
                // Setup tool buttons
                setupToolButtons();
                
                // Setup UI updates
                setupUIUpdates();
                
                // Setup input handlers
                setupInputHandlers();
                
                // Make globally available
                window.advancedEditor = advancedEditor;
                window.collisionEditor = collisionEditor;
                
                console.log('üöÄ Advanced Map Editor fully loaded and ready!');
                
            } catch (error) {
                console.error('‚ùå Failed to initialize Advanced Map Editor:', error);
                document.getElementById('statusMessage').textContent = `Error: ${error.message}`;
            }
        });
        
        function setupToolButtons() {
            const toolButtons = document.querySelectorAll('.tool-btn');
            
            toolButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tool = btn.dataset.tool;
                    
                    // Update active state
                    toolButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Set tool in editor
                    if (advancedEditor) {
                        advancedEditor.setTool(tool);
                    }
                    
                    // Update coordinates display
                    const coordsDisplay = document.getElementById('coordinatesDisplay');
                    const currentText = coordsDisplay.textContent;
                    const toolName = btn.title.split(' ')[0];
                    coordsDisplay.textContent = currentText.replace(/Tool: \w+/, `Tool: ${toolName}`);
                });
            });
        }
        
        function setupUIUpdates() {
            // Update performance indicators
            setInterval(() => {
                if (advancedEditor?.performanceMonitor) {
                    const fps = Math.round(advancedEditor.performanceMonitor.getAverageFrameRate());
                    const memory = advancedEditor.performanceMonitor.getMemoryUsage().toFixed(1);
                    
                    document.getElementById('fpsDisplay').textContent = `${fps} FPS`;
                    document.getElementById('memoryDisplay').textContent = `${memory} MB`;
                }
            }, 1000);
            
            // Update collision stats and UI when island is selected
            if (advancedEditor?.eventBus) {
                advancedEditor.eventBus.on('island:selected', (data) => {
                    updateCollisionStats();
                    updateIslandPropertiesUI();
                });
            }
        }
        
        function updateIslandPropertiesUI() {
            if (!advancedEditor?.selectedIsland) return;
            
            const island = advancedEditor.selectedIsland;
            
            // Update all the input fields with current island values
            document.getElementById('islandX').value = island.x || 0;
            document.getElementById('islandY').value = island.y || 0;
            document.getElementById('islandWidth').value = island.width || 800;
            document.getElementById('islandHeight').value = island.height || 600;
            document.getElementById('islandRotation').value = island.rotation || 0;
            document.getElementById('islandRotationValue').value = island.rotation || 0;
            document.getElementById('islandRadius').value = island.radius || 150;
            document.getElementById('islandRadiusValue').value = island.radius || 150;
            
            // Update status
            document.getElementById('selectionInfo').textContent = `Selected: ${island.name} (${island.width}x${island.height})`;
        }
        
        function setupInputHandlers() {
            // Island property inputs
            const inputs = ['islandX', 'islandY', 'islandWidth', 'islandHeight', 'islandRotation', 'islandRotationValue', 'islandRadius', 'islandRadiusValue'];
            
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', (e) => {
                        handlePropertyChange(inputId, e.target.value);
                    });
                }
            });
        }
        
        function handlePropertyChange(property, value) {
            if (!advancedEditor?.selectedIsland) return;
            
            const island = advancedEditor.selectedIsland;
            
            // Save undo state before making changes
            advancedEditor.saveUndoState('island:modify', `Changed ${property} of ${island.name}`);
            
            switch (property) {
                case 'islandX':
                    island.x = parseFloat(value);
                    break;
                case 'islandY':
                    island.y = parseFloat(value);
                    break;
                case 'islandWidth':
                    island.width = parseFloat(value);
                    break;
                case 'islandHeight':
                    island.height = parseFloat(value);
                    break;
                case 'islandRotation':
                case 'islandRotationValue':
                    island.rotation = parseFloat(value);
                    // Sync both rotation inputs
                    document.getElementById('islandRotation').value = value;
                    document.getElementById('islandRotationValue').value = value;
                    break;
                case 'islandRadius':
                case 'islandRadiusValue':
                    island.radius = parseFloat(value);
                    // Sync both radius inputs
                    document.getElementById('islandRadius').value = value;
                    document.getElementById('islandRadiusValue').value = value;
                    break;
            }
            
            advancedEditor.markDirty();
        }
        
        function updateCollisionStats() {
            const statsDiv = document.getElementById('collisionStats');
            
            if (collisionEditor && advancedEditor?.selectedIsland) {
                const stats = collisionEditor.getStats();
                if (stats) {
                    statsDiv.innerHTML = `
                        Points: ${stats.pointCount}<br>
                        Selected: ${stats.selectedPoints}<br>
                        Area: ${Math.round(stats.area)} px¬≤<br>
                        Perimeter: ${Math.round(stats.perimeter)} px
                    `;
                } else {
                    statsDiv.textContent = 'No collision data';
                }
            } else {
                statsDiv.textContent = 'Select an island to edit collision';
            }
        }
        
        // Global functions for UI buttons
        window.showDebugPanel = function() {
            document.getElementById('debugPanel').style.display = 'flex';
        };
        
        window.updateDebugContent = function(content) {
            document.getElementById('debugContent').innerHTML = content;
        };
        
        // Update mouse coordinates
        document.addEventListener('mousemove', (e) => {
            if (advancedEditor?.canvas) {
                const rect = advancedEditor.canvas.getBoundingClientRect();
                const mouseX = Math.round(e.clientX - rect.left);
                const mouseY = Math.round(e.clientY - rect.top);
                
                // Calculate world coordinates
                const worldX = Math.round((mouseX - advancedEditor.state.viewport.offsetX) / advancedEditor.state.viewport.zoom);
                const worldY = Math.round((mouseY - advancedEditor.state.viewport.offsetY) / advancedEditor.state.viewport.zoom);
                
                const tool = document.querySelector('.tool-btn.active')?.title?.split(' ')[0] || 'Select';
                
                document.getElementById('coordinatesDisplay').textContent = 
                    `Mouse: (${mouseX}, ${mouseY}) | World: (${worldX}, ${worldY}) | Tool: ${tool}`;
            }
        });
    </script>
</body>
</html>